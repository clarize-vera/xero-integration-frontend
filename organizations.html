<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Organizations</title>
  <script src="js/api.js"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 1000px; margin: 50px auto; padding: 20px; background: #f5f5f5; }
    .container { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h1 { color: #13B5EA; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #E5E7EB; }
    th { background: #F9FAFB; font-weight: 600; color: #374151; }
    tr:hover { background: #F9FAFB; }
    .button { display: inline-block; padding: 8px 16px; background: #13B5EA; color: white; text-decoration: none; border-radius: 4px; font-size: 14px; border: none; cursor: pointer; }
    .button:hover { background: #0E8AB8; }
    .status { padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; background: #D1FAE5; color: #065F46; }
    .loading { text-align: center; padding: 40px; color: #6B7280; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üè¢ Connected Organizations</h1>
    <div id="content"><div class="loading">Loading...</div></div>
    <div style="margin-top: 20px;">
      <a href="index.html" class="button">üè† Home</a>
      <a href="dashboard.html" class="button">üìä Dashboard</a>
      <button onclick="API.connectOrganization()" class="button">‚ûï Connect Another</button>
    </div>
  </div>

  <script>
    loadOrganizations()

    async function loadOrganizations() {
      try {
        const data = await API.listOrganizations()
        const orgs = data.organizations

        if (orgs.length === 0) {
          document.getElementById('content').innerHTML = `
            <p>No organizations connected yet.</p>
            <button onclick="API.connectOrganization()" class="button">Connect Your First Organization</button>
          `
          return
        }

        document.getElementById('content').innerHTML = `
          <p>Total: ${orgs.length} organization${orgs.length !== 1 ? 's' : ''}</p>
          <table>
            <thead>
              <tr>
                <th>Organization</th>
                <th>Status</th>
                <th>Last Synced</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              ${orgs.map(org => `
                <tr>
                  <td><strong>${org.tenant_name}</strong></td>
                  <td><span class="status">Active</span></td>
                  <td>${org.last_sync_at ? new Date(org.last_sync_at).toLocaleString() : 'Never'}</td>
                  <td>
                    <button onclick="syncOrg('${org.tenant_id}')" class="button">Sync Now</button>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `
      } catch (error) {
        document.getElementById('content').innerHTML = `<div style="color: red;">Error: ${error.message}</div>`
      }
    }

    async function syncOrg(tenantId) {
      if (!confirm('Start sync for this organization?')) return

      try {
        const result = await API.syncOrganization(tenantId)
        alert(`Sync completed! ${result.count} transactions synced.`)
        loadOrganizations()
      } catch (error) {
        alert('Error: ' + error.message)
      }
    }
  </script>
</body>
</html>
